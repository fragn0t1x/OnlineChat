<!DOCTYPE html>
<html>
<head>
  <title>Оператор</title>
</head>
<body>
  <h1>Операторский интерфейс</h1>
  <div id="messages"></div>
  <input type="text" id="reply" />
  <button onclick="sendReply()">Отправить</button>

  <script>
    const chatId = new URLSearchParams(window.location.search).get('chat_id');
    document.title += ` — Чат ${chatId}`;

    async function loadMessages() {
      const res = await fetch(`/api/chat/${chatId}`);
      const data = await res.json();
      const el = document.getElementById('messages');
      el.innerHTML = '';
      data.messages.forEach(m => {
        el.innerHTML += `<div><b>${m.sender}:</b> ${m.text}</div>`;
      });
    }

    async function sendReply() {
      const text = document.getElementById('reply').value;
      await fetch(`/api/chat/${chatId}/reply`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({text})
      });
      document.getElementById('reply').value = '';
      loadMessages();
    }

    loadMessages();
    setInterval(loadMessages, 2000);
  </script>
</body>
</html>